commit 1b4a1707546d9d84aac03e916e7f250a924b55ad
Author: Alec Leamas <leamas.alec@gmail.com>
Date:   Sat Apr 1 11:10:36 2017 +0200

    Handle systemd new pkg-config filename (#274)

diff --git a/configure.ac b/configure.ac
index 29178d6..23f745e 100644
--- a/configure.ac
+++ b/configure.ac
@@ -394,6 +394,7 @@ AC_CHECK_HEADERS(linux/i2c-dev.h,[
 )
 
 PKG_CHECK_MODULES([SYSTEMD],[libsystemd-daemon],,[true])
+test -n "$SYSTEMD_LIBS" || PKG_CHECK_MODULES([SYSTEMD],[libsystemd],,[true])
 if test -n "$SYSTEMD_LIBS"; then
   CFLAGS="$CFLAGS $SYSTEMD_CFLAGS"
   AC_DEFINE(HAVE_SYSTEMD)
@@ -532,6 +533,7 @@ AC_REPORT_CONDITIONAL([DEVEL])
 AC_REPORT_CONDITIONAL([HAVE_UINPUT])
 AC_REPORT_CONDITIONAL([DARWIN])
 AC_REPORT_CONDITIONAL([LINUX_KERNEL])
+AC_REPORT_CONDITIONAL([HAVE_SYSTEMD])
 
 echo
 
diff --git a/configure b/configure
index 29178d6..23f745e 100644
--- a/configure
+++ b/configure
@@ -19051,12 +19051,12 @@
     pkg_cv_SYSTEMD_CFLAGS="$SYSTEMD_CFLAGS"
  elif test -n "$PKG_CONFIG"; then
     if test -n "$PKG_CONFIG" && \
-    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libsystemd-daemon\""; } >&5
-  ($PKG_CONFIG --exists --print-errors "libsystemd-daemon") 2>&5
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libsystemd\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libsystemd") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-  pkg_cv_SYSTEMD_CFLAGS=`$PKG_CONFIG --cflags "libsystemd-daemon" 2>/dev/null`
+  pkg_cv_SYSTEMD_CFLAGS=`$PKG_CONFIG --cflags "libsystemd" 2>/dev/null`
 		      test "x$?" != "x0" && pkg_failed=yes
 else
   pkg_failed=yes
@@ -19068,12 +19068,12 @@
     pkg_cv_SYSTEMD_LIBS="$SYSTEMD_LIBS"
  elif test -n "$PKG_CONFIG"; then
     if test -n "$PKG_CONFIG" && \
-    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libsystemd-daemon\""; } >&5
-  ($PKG_CONFIG --exists --print-errors "libsystemd-daemon") 2>&5
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libsystemd\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libsystemd") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-  pkg_cv_SYSTEMD_LIBS=`$PKG_CONFIG --libs "libsystemd-daemon" 2>/dev/null`
+  pkg_cv_SYSTEMD_LIBS=`$PKG_CONFIG --libs "libsystemd" 2>/dev/null`
 		      test "x$?" != "x0" && pkg_failed=yes
 else
   pkg_failed=yes
@@ -19094,9 +19094,9 @@
         _pkg_short_errors_supported=no
 fi
         if test $_pkg_short_errors_supported = yes; then
-	        SYSTEMD_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "libsystemd-daemon" 2>&1`
+	        SYSTEMD_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "libsystemd" 2>&1`
         else
-	        SYSTEMD_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "libsystemd-daemon" 2>&1`
+	        SYSTEMD_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "libsystemd" 2>&1`
         fi
 	# Put the nasty error message in config.log where it belongs
 	echo "$SYSTEMD_PKG_ERRORS" >&5
diff --git a/daemons/lircd.cpp b/daemons/lircd.cpp
index b1b3743..b73c2c0 100644
--- a/daemons/lircd.cpp
+++ b/daemons/lircd.cpp
@@ -971,10 +971,12 @@ void start_server(mode_t permission, int nodaemon, loglevel_t loglevel)
 		fprintf(stderr, "Too many file descriptors received.\n");
 		goto start_server_failed0;
 	} else if (n == 1) {
+	        log_notice("Using systemd fd");
 		sockfd = SD_LISTEN_FDS_START + 0;
 	}
 #endif
 	if (sockfd == -1) {
+	        log_debug("No systemd fd found");
 		sockfd = socket(AF_UNIX, SOCK_STREAM, 0);
 		if (sockfd == -1) {
 			perror("Could not create socket");
